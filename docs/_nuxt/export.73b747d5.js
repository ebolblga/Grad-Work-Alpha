import w from"./Icon.33aefd97.js";import{_ as h}from"./my-button.016914e7.js";import{u as j}from"./composables.6e69d408.js";import{t as u}from"./subjectParsing.7a17cc8c.js";import{N as v}from"./navbar.1e78db91.js";import{a as O,r as A,o as C,j as E,J as c,F as a,G as d,q as p}from"./entry.f072ed3f.js";import"./config.48700020.js";const I={class:"h-screen flex flex-col"},T={class:"h-[92vh] p-5 flex justify-center"},R={class:"w-[40%] flex flex-col my-auto min-w-[360px]"},D={for:"upload-file",class:"cursor-pointer"},U=c("p",{class:"text-lg font-black"}," Экспорт расписания: ",-1),V=c("div",{class:"w-full h-0 border border-[#764462] mb-7"},null,-1),G=O({__name:"export",setup(J){j({title:"Экспортировать расписание"});const s=JSON.parse(localStorage.getItem("subjectsJSON")||""),r=A(localStorage.getItem("group")||"");function N(){let l=`BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//MSUT "STANKIN"//Schedule//RU

`;for(let t=0;t<s.length;t++)for(let i=0;i<s[t].dates.length;i++){const y=s[t].type.replace("Лекции","Лекция").replace("Cеминары","Cеминар").replace("Лабораторные занятия","Лабораторное занятие"),b=(s[t].type==="Лабораторные занятия"?u.get(s[t].time+8):u.get(s[t].time)).split(" - "),S=s[t].dates[i].split("T");let m=new Date(S[0]+"T"+b[0]),f=new Date(S[0]+"T"+b[1]);m.setHours(m.getHours()+25),f.setHours(f.getHours()+25),l+=`BEGIN:VEVENT
UID:${t.toString()+i.toString()}
DTSTART:${m.toISOString()}
DTEND:${f.toISOString()}
SUMMARY:${s[t].name}
DESCRIPTION:${y+": "+s[t].groups.join(", ")+" "+s[t].subgroup}
LOCATION:${s[t].location}
END:VEVENT

`}l+="END:VCALENDAR";const e=new Blob([l],{type:"text/ics;charset=UTF-8"}),n=window.URL.createObjectURL(e),o=document.createElement("a");o.setAttribute("href",n),o.setAttribute("download",r.value!=""?r.value+".ics":"schedule.ics"),o.click()}function _(){const l=[['"Группа или преподователь',"Подгруппа","Предмет","Тип занятия","Кабинет","Время","URL","Строка дат","Даты"],...s.map(t=>[t.groups.join(", "),t.subgroup,t.name,t.type,t.location,t.type==="Лабораторные занятия"?u.get(t.time+8):u.get(t.time),t.url,t.dateStr,t.dates.join(" ")])].map(t=>t.join('","')).join(`"
"`),e=new Blob([l],{type:"text/csv;charset=UTF-8"}),n=window.URL.createObjectURL(e),o=document.createElement("a");o.setAttribute("href",n),o.setAttribute("download",r.value!=""?r.value+".csv":"schedule.csv"),o.click()}function g(){const l="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(s,null,"	")),e=document.createElement("a");e.setAttribute("href",l),e.setAttribute("download",r.value!=""?r.value+".json":"schedule.json"),document.body.appendChild(e),e.click(),e.remove()}function x(l){const e=l.target.files[0],n=new FileReader;n.readAsText(e,"UTF-8"),n.onload=()=>{const o=JSON.parse(n.result);localStorage.setItem("subjectsJSON",JSON.stringify(o))},n.onerror=o=>{console.log(o)}}return(l,e)=>{const n=w,o=h;return C(),E("div",I,[c("div",T,[c("div",R,[a(o,{class:"mb-14 w-full"},{default:d(()=>[c("label",D,[p("Импортировать JSON "),c("input",{type:"file",id:"upload-file",accept:".json",hidden:"",onChange:e[0]||(e[0]=t=>x(t))},null,32)]),a(n,{class:"ml-5 my-auto",name:"bi:filetype-json",size:"18px"})]),_:1}),U,V,a(o,{onClick:e[1]||(e[1]=t=>g()),class:"mb-7 w-full"},{default:d(()=>[p("Экспортировать JSON"),a(n,{class:"ml-5 my-auto",name:"bi:filetype-json",size:"18px"})]),_:1}),a(o,{onClick:e[2]||(e[2]=t=>_()),class:"mb-7 w-full"},{default:d(()=>[p("Экспортировать CSV"),a(n,{class:"ml-5 my-auto",name:"bi:filetype-csv",size:"18px"})]),_:1}),a(o,{onClick:e[3]||(e[3]=t=>N()),class:"mb-7 w-full"},{default:d(()=>[p("Экспортировать ICS"),a(n,{class:"ml-5 my-auto",name:"uil:calender",size:"18px"})]),_:1})])]),a(v)])}}});export{G as default};
