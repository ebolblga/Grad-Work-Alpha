import w from"./Icon.a229c625.js";import{_ as j}from"./my-button.ef23812b.js";import{u as C}from"./composables.59856f01.js";import{t as u}from"./subjectParsing.7d33b0a7.js";import{N as T}from"./navbar.c5324ded.js";import{a as v,r as O,o as A,j as E,J as p,F as a,G as f,q as S}from"./entry.d7192b5b.js";import"./config.93b407ec.js";const I={class:"h-screen flex flex-col"},R={class:"h-[92vh] p-5 flex justify-center"},D={class:"w-[40%] flex flex-col my-auto min-w-[360px]"},U={for:"upload-file",class:"cursor-pointer"},V=p("p",{class:"text-lg font-black"}," Экспорт расписания: ",-1),J=p("div",{class:"w-full h-0 border border-[#764462] mb-7"},null,-1),M=v({__name:"export",setup($){C({title:"Экспортировать расписание"});const o=JSON.parse(localStorage.getItem("subjectsJSON")||""),c=O(localStorage.getItem("group")||"");function _(){let l=`BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//MSUT "STANKIN"//Schedule//RU

`;for(let t=0;t<o.length;t++)for(let i=0;i<o[t].dates.length;i++){const d=o[t].type.replace("Лекции","Лекция").replace("Cеминары","Cеминар").replace("Лабораторные занятия","Лабораторное занятие"),r=(o[t].type==="Лабораторные занятия"?u.get(o[t].time+8):u.get(o[t].time)).split(" - ");console.log(o[t].dates[i]);const m=o[t].dates[i].split("T");console.log(m[0]+"T"+r[0]+":00.000Z");let b=new Date(m[0]+"T"+r[0]+":00.000Z"),N=new Date(m[0]+"T"+r[1]+":00.000Z");b.setHours(b.getHours()+24),N.setHours(N.getHours()+24),l+=`BEGIN:VEVENT
UID:${t.toString()+i.toString()}
DTSTART:${b.toISOString()}
DTEND:${N.toISOString()}
SUMMARY:${o[t].name}
DESCRIPTION:${d+": "+o[t].groups.join(", ")+" "+o[t].subgroup}
LOCATION:${o[t].location}
END:VEVENT

`}l+="END:VCALENDAR";const n=new Blob([l],{type:"text/ics;charset=UTF-8"}),s=window.URL.createObjectURL(n),e=document.createElement("a");e.setAttribute("href",s),e.setAttribute("download",c.value!=""?c.value+".ics":"schedule.ics"),e.click()}function y(){const l=[['"Группа или преподователь',"Подгруппа","Предмет","Тип занятия","Кабинет","Время","URL","Строка дат","Даты"],...o.map(t=>[t.groups.join(", "),t.subgroup,t.name,t.type,t.location,t.type==="Лабораторные занятия"?u.get(t.time+8):u.get(t.time),t.url,t.dateStr,t.dates.join(" ")])].map(t=>t.join('","')).join(`"
"`),n=new Blob([l],{type:"text/csv;charset=UTF-8"}),s=window.URL.createObjectURL(n),e=document.createElement("a");e.setAttribute("href",s),e.setAttribute("download",c.value!=""?c.value+".csv":"schedule.csv"),e.click()}function x(){const l=o;for(let e=0;e<o.length;e++)for(let t=0;t<o[e].dates.length;t++){l[e].type=o[e].type.replace("Лекции","Лекция").replace("Cеминары","Cеминар").replace("Лабораторные занятия","Лабораторное занятие");const d=(o[e].type==="Лабораторные занятия"?u.get(o[e].time+8):u.get(o[e].time)).split(" - "),g=o[e].dates[t].split("T");let r=new Date(g[0]+"T"+d[0]+":00.000Z");new Date(g[0]+"T"+d[1]+":00.000Z"),r.setHours(r.getHours()+24),o[e].dates[t]=r.toISOString();try{o[e].name=o[e].name.trimStart(),o[e].groups[t]=o[e].groups[t].trimStart(),o[e].dateStr=o[e].dateStr.trimStart()}catch{}}const n="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(l,null,"	")),s=document.createElement("a");s.setAttribute("href",n),s.setAttribute("download",c.value!=""?c.value+".json":"schedule.json"),document.body.appendChild(s),s.click(),s.remove()}function h(l){const n=l.target.files[0],s=new FileReader;s.readAsText(n,"UTF-8"),s.onload=()=>{const e=JSON.parse(s.result);for(let t=0;t<e.length;t++)e[t].type=e[t].type.replace("Лекция","Лекции").replace("Cеминар","Cеминары").replace("Лабораторное занятие","Лабораторные занятия");localStorage.setItem("subjectsJSON",JSON.stringify(e))},s.onerror=e=>{console.log(e)}}return(l,n)=>{const s=w,e=j;return A(),E("div",I,[p("div",R,[p("div",D,[a(e,{class:"mb-14 w-full"},{default:f(()=>[p("label",U,[S("Импортировать JSON "),p("input",{type:"file",id:"upload-file",accept:".json",hidden:"",onChange:n[0]||(n[0]=t=>h(t))},null,32)]),a(s,{class:"ml-5 my-auto",name:"bi:filetype-json",size:"18px"})]),_:1}),V,J,a(e,{onClick:n[1]||(n[1]=t=>x()),class:"mb-7 w-full"},{default:f(()=>[S("Экспортировать JSON"),a(s,{class:"ml-5 my-auto",name:"bi:filetype-json",size:"18px"})]),_:1}),a(e,{onClick:n[2]||(n[2]=t=>y()),class:"mb-7 w-full"},{default:f(()=>[S("Экспортировать CSV"),a(s,{class:"ml-5 my-auto",name:"bi:filetype-csv",size:"18px"})]),_:1}),a(e,{onClick:n[3]||(n[3]=t=>_()),class:"mb-7 w-full"},{default:f(()=>[S("Экспортировать ICS"),a(s,{class:"ml-5 my-auto",name:"uil:calender",size:"18px"})]),_:1})])]),a(T)])}}});export{M as default};
